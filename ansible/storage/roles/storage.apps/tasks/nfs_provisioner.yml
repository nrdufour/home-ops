---

- name: Add nfs-subdir-external-provisioner chart repo
  kubernetes.core.helm_repository:
    name: nfs-subdir-external-provisioner
    repo_url: "https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/"

- name: Install nfs-subdir-external-provisioner controller
  kubernetes.core.helm:
    kubeconfig: /etc/rancher/k3s/k3s.yaml
    name: nfs-subdir-external-provisioner
    chart_ref: nfs-subdir-external-provisioner/nfs-subdir-external-provisioner
    update_repo_cache: yes
    release_namespace: default
    values:
      nfs:
        server: possum.home
        path: "{{ nfs_base_dir }}"
